<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="underbar.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <div class="appContainer"></div>
    <script>

      window.userPage = false;

      $(document).ready(function(){

        //show originally generated set of random tweets;
        var $body = $('.appContainer');
        $body.html('');
        var index = streams.home.length - 1;
        while(index >= 0){
            displayTweets(index,'appendTo',$body);
          index -= 1;
        }

        // listen for user name link clicks and then show that user
        $(".appContainer").on("click","a",function(){
          console.log('working');
        });
      
      });

      function getLatestTweets(stream, timeOfLastTweet){
        var latestTweets = _.filter(stream,function(item){return item.created_at > (timeOfLastTweet);});
        timeOfLastTweet = stream[stream.length-1].created_at;
        setTimeout(getLatestTweets,3000,stream,timeOfLastTweet);
      }

      function displayTweets(index,appendType,appendLocation,name){
        var tweet = (name) ? streams.users[name][index] : streams.home[index];
        var $tweet = $("<div>@<a href='#'>" + tweet.user + "</a>: " + tweet.message + " - created on: " + dateParse(tweet.created_at) + "</div>");
        $tweet[appendType](appendLocation);
      }

      // utility function for parsing dates stored in tweets.created_at
      function dateParse(date) {
        var hourParse = function (hour) {
          return (hour > 12) ? hour - 12 : hour;
        };
        var parsedDate = [date.getFullYear(),
                        date.getMonth() + 1,
                        date.getDate(),
                        hourParse(date.getHours()),
                        date.getMinutes(),
                        date.getSeconds()];
        return parsedDate.join('-');
      }
    </script>
  </body>
</html>
