<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="underbar.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <div class="appContainer"></div>
    <script>

      window.userPage = false;

      $(document).ready(function(){

        //show originally generated set of random tweets;
        var $body = $('.appContainer');
        $body.html('');
        var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $("<div>@<a href='#'>" + tweet.user + "</a>: " + tweet.message + " - created on: " + dateParse(tweet.created_at) + "</div>");
          $tweet.appendTo($body);
          index -= 1;
        }

        getLatestTweets(streams.home);

        // listen for user name link clicks and then show that user
        $(".appContainer").on("click","a",function(){
        });
      
      });

      function getLatestTweets(stream, timeOfLastTweet){
        window.latestTweets = _.filter(stream,function(item){return item.created_at > (timeOfLastTweet);});
        timeOfLastTweet = (timeOfLastTweet) ? stream[stream.length-1].created_at : stream[stream.length-1].created_at;
        if(latestTweets[0]){displayTweets(latestTweets,'prependTo',$('.appContainer'));}
        setTimeout(getLatestTweets,4000,stream,timeOfLastTweet);
      }

      function displayTweets(tweetArray,appendType,appendLocation){
        console.log(tweetArray);
        var tweet = tweetArray[0];
        var $tweet = $("<div>@<a href='#'>" + tweet.user + "</a>: " + tweet.message + " - created on: " + dateParse(tweet.created_at) + "</div>");
        $tweet[appendType](appendLocation);
      }

      // utility function for parsing dates stored in tweets.created_at
      function dateParse(date) {
        var hourParse = function (hour) {
          return (hour > 12) ? hour - 12 : hour;
        };
        var parsedDate = [date.getFullYear(),
                        date.getMonth() + 1,
                        date.getDate(),
                        hourParse(date.getHours()),
                        date.getMinutes(),
                        date.getSeconds()];
        return parsedDate.join('-');
      }
    </script>
  </body>
</html>
