<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      window.userPage = false;

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');
        console.log(streams.home.length);
        var index = streams.home.length - 1;
        while(index >= 0){
          displayNewTweets(index,'appendTo',$body);
          index -= 1;
        }
        $("a").on('click',function(){
          console.log($(this).text());
          showUser($(this).text());
        })
        addNewTweets('home');
      });

      function showUser(userName){
        var $body = $('body');
        $body.html('');
        window.userPage = true;
        var index = streams.users[userName].length - 1;
        while(index >= 0){
          var tweet = streams.users[userName][index];
          var $tweet = $('<div></div>');
          var linkedUser = "<a href='#'>" + tweet.user + "</a>";
          $tweet.html('@' + linkedUser + ': ' + tweet.message + ' - created on: ' + dateParse(tweet.created_at));
          $tweet['appendTo']($body);
          index -= 1;
        }
      }

      function addNewTweets(kind){
        if(!window.userPage){
          scheduleNextTweet();
          var l = streams[kind].length - 1;
          displayNewTweets(l,'prependTo',$('body'));
          setTimeout(addNewTweets, 2000, kind);
        }
      }

      function displayNewTweets(ind,appendType,appendLocation){
        var tweet = streams.home[ind];
        var $tweet = $('<div></div>');
        var linkedUser = "<a href='#'>" + tweet.user + "</a>";
        $tweet.html('@' + linkedUser + ': ' + tweet.message + ' - created on: ' + dateParse(tweet.created_at));
        $tweet[appendType](appendLocation);
      }

      // utility function for parsing dates created by data_generator.js and stored in tweets.created_at
      function dateParse(date) {
        var hourParse = function (hour) {
          return (hour > 12) ? hour - 12 : hour;
        }
        var parsedDate = [date.getFullYear(),
                        date.getMonth() + 1,
                        date.getDate(),
                        hourParse(date.getHours()),
                        date.getMinutes(),
                        date.getSeconds()];
        return parsedDate.join('-');
      }
    </script>
  </body>
</html>
